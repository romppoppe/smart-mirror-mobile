<ion-header class="ion-no-border">
  <ion-toolbar class="transparent-toolbar">
    <ion-title style="color: white;">Completar Perfil</ion-title>

    <!-- Solo escape permitido -->
    <ion-buttons slot="end">
      <ion-button fill="clear" color="light" (click)="logout()">
        Cerrar sesiÃ³n
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="bg-gradient">
  <!-- Contenedor general -->
  <div class="ion-padding" style="padding-bottom: 120px;">
    <!-- Hero -->
    <div class="setup-hero">
      <div class="setup-badge">Paso 1 de 1</div>

      <h1 class="setup-title">Â¡Casi listo! ðŸš€</h1>
      <p class="setup-subtitle">
        Necesitamos estos datos para calibrar la IA y habilitar el uso del espejo.
      </p>

      <p class="setup-email" *ngIf="profileEmail">
        {{ profileEmail }}
      </p>
    </div>

    <!-- Form -->
    <div class="glass-card" *ngIf="!loading; else loadingTpl">
      <div class="input-group">
        <label>Nombre Completo <span class="req">*</span></label>
        <div class="glass-input-wrapper">
          <input
            type="text"
            [(ngModel)]="profileData.displayName"
            placeholder="Ej: David PÃ©rez"
            autocomplete="name"
          />
        </div>
      </div>

      <div class="row-inputs">
        <div class="input-group half">
          <label>Edad <span class="req">*</span></label>
          <div class="glass-input-wrapper">
            <input
              type="number"
              [(ngModel)]="profileData.age"
              placeholder="Ej: 25"
              inputmode="numeric"
              min="1"
              max="119"
            />
          </div>
        </div>

        <div class="input-group half">
          <label>Sexo</label>
          <div class="glass-input-wrapper">
            <select [(ngModel)]="profileData.sex">
              <option value="male">Hombre</option>
              <option value="female">Mujer</option>
              <option value="other">Otro</option>
            </select>
          </div>
        </div>
      </div>

      <div class="row-inputs">
        <div class="input-group half">
          <label>Peso (kg)</label>
          <div class="glass-input-wrapper">
            <input
              type="number"
              [(ngModel)]="profileData.weight"
              placeholder="Ej: 62"
              inputmode="decimal"
              min="1"
              max="399"
            />
          </div>
        </div>

        <div class="input-group half">
          <label>Altura (cm)</label>
          <div class="glass-input-wrapper">
            <input
              type="number"
              [(ngModel)]="profileData.height"
              placeholder="Ej: 175"
              inputmode="numeric"
              min="30"
              max="259"
            />
          </div>
        </div>
      </div>

      <div class="input-group">
        <label>Nivel de Actividad</label>
        <div class="glass-input-wrapper">
          <select [(ngModel)]="profileData.activityLevel">
            <option value="sedentary">Sedentario</option>
            <option value="light">Ligero (1-3 dÃ­as)</option>
            <option value="moderate">Moderado (3-5 dÃ­as)</option>
            <option value="active">Muy Activo (Diario)</option>
          </select>
        </div>
      </div>

      <!-- Mensaje de validaciÃ³n -->
      <div class="form-hint" *ngIf="!formValid">
        <ion-icon name="information-circle-outline"></ion-icon>
        <span>Completa <strong>Nombre</strong> y <strong>Edad</strong> para continuar.</span>
      </div>

      <p class="hint-text" style="margin-top: 10px; opacity: 0.75;">
        * Nombre y edad son obligatorios.
      </p>
    </div>

    <ng-template #loadingTpl>
      <div class="glass-card">
        <ion-skeleton-text animated style="height: 18px; width: 70%;"></ion-skeleton-text>
        <ion-skeleton-text animated style="height: 44px; width: 100%; margin-top: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="height: 44px; width: 100%; margin-top: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="height: 44px; width: 100%; margin-top: 12px;"></ion-skeleton-text>
        <ion-skeleton-text animated style="height: 50px; width: 100%; margin-top: 18px;"></ion-skeleton-text>
      </div>
    </ng-template>
  </div>

  <!-- âœ… CTA fijo abajo -->
  <div class="setup-cta">
    <button
      class="magic-button"
      [disabled]="saving || !formValid || loading"
      (click)="saveProfile()"
    >
      {{ saving ? 'GUARDANDO...' : 'GUARDAR Y CONTINUAR' }}
    </button>
  </div>
</ion-content>
