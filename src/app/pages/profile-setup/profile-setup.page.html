<ion-content [fullscreen]="true" class="bg-hud">
  
  <div class="hud-scanlines"></div>
  <div class="hud-glow"></div>

  <div class="main-container ion-padding-bottom">

    <header class="hud-header">
      <div class="header-top">
        <div class="brand-group">
          <div class="logo-box">
            <svg class="lucide-icon"><use href="#lucide-scan"></use></svg>
          </div>
          <div class="titles">
            <h1>ConfiguraciÃ³n</h1>
            <span class="device-badge connected">Perfil de Usuario</span>
          </div>
        </div>

        <div class="header-actions">
          <button class="icon-btn" (click)="logout()">
             <svg class="lucide-icon"><use href="#lucide-power-outline"></use></svg> 
             <span style="font-size: 10px; font-weight: 700;">SALIR</span>
          </button>
        </div>
      </div>
    </header>

    <div class="content-stack">
      
      <div class="setup-hero">
        <div class="status-badge-row">
          <span class="status-pill">PASO 1 DE 1</span>
        </div>
        <h2 class="text-glow">Â¡Casi listo! ðŸš€</h2>
        <p class="subtitle">
          Necesitamos estos datos para calibrar la IA del espejo.
        </p>
        <p class="email-badge" *ngIf="profileEmail">
          {{ profileEmail }}
        </p>
      </div>

      <div class="hud-card form-card" *ngIf="!loading; else loadingTpl">
        <div class="hud-brackets"></div>

        <div class="input-group">
          <label>Nombre Completo <span class="req">*</span></label>
          <div class="glass-input">
            <input
              type="text"
              [(ngModel)]="profileData.displayName"
              placeholder="Ej: David PÃ©rez"
              autocomplete="name"
            />
          </div>
        </div>

        <div class="row-inputs">
          <div class="input-group half">
            <label>Edad <span class="req">*</span></label>
            <div class="glass-input">
              <input
                type="number"
                [(ngModel)]="profileData.age"
                placeholder="25"
                inputmode="numeric"
                min="1"
                max="119"
              />
            </div>
          </div>

          <div class="input-group half">
            <label>Sexo</label>
            <div class="glass-input">
              <select [(ngModel)]="profileData.sex">
                <option value="male">Hombre</option>
                <option value="female">Mujer</option>
                <option value="other">Otro</option>
              </select>
            </div>
          </div>
        </div>

        <div class="row-inputs">
          <div class="input-group half">
            <label>Peso (kg)</label>
            <div class="glass-input">
              <input
                type="number"
                [(ngModel)]="profileData.weight"
                placeholder="62"
                inputmode="decimal"
              />
            </div>
          </div>

          <div class="input-group half">
            <label>Altura (cm)</label>
            <div class="glass-input">
              <input
                type="number"
                [(ngModel)]="profileData.height"
                placeholder="175"
                inputmode="numeric"
              />
            </div>
          </div>
        </div>

        <div class="input-group">
          <label>Nivel de Actividad</label>
          <div class="glass-input">
            <select [(ngModel)]="profileData.activityLevel">
              <option value="sedentary">Sedentario</option>
              <option value="light">Ligero (1-3 dÃ­as)</option>
              <option value="moderate">Moderado (3-5 dÃ­as)</option>
              <option value="active">Muy Activo (Diario)</option>
            </select>
          </div>
        </div>

        <div class="validation-msg" *ngIf="!formValid">
          <svg class="lucide-icon"><use href="#lucide-alert-circle"></use></svg>
          <span>Falta Nombre o Edad</span>
        </div>

      </div>

      <ng-template #loadingTpl>
        <div class="hud-card">
          <ion-skeleton-text animated style="height: 20px; width: 40%; margin-bottom: 20px; border-radius: 4px; opacity: 0.2;"></ion-skeleton-text>
          <ion-skeleton-text animated style="height: 50px; width: 100%; margin-bottom: 15px; border-radius: 12px; opacity: 0.1;"></ion-skeleton-text>
          <ion-skeleton-text animated style="height: 50px; width: 100%; margin-bottom: 15px; border-radius: 12px; opacity: 0.1;"></ion-skeleton-text>
        </div>
      </ng-template>

    </div>
  </div>

  <div class="bottom-action-bar">
    <button
      class="activate-btn"
      [disabled]="saving || !formValid || loading"
      (click)="saveProfile()"
    >
      <div class="shimmer-effect"></div>
      <div class="btn-content">
        <ion-spinner *ngIf="saving" name="crescent" style="width: 20px; height: 20px;"></ion-spinner>
        <span>{{ saving ? 'GUARDANDO...' : 'GUARDAR Y CONTINUAR' }}</span>
        <svg *ngIf="!saving" class="lucide-icon"><use href="#lucide-chevron-right"></use></svg>
      </div>
    </button>
  </div>

</ion-content>