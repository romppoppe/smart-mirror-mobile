<ion-content [fullscreen]="true" class="bg-gradient">
  
  <div class="header-section ion-padding-top ion-padding-horizontal">
    <div class="profile-row">
      <div>
        <h1 class="greeting">
          Hola, 
          <ng-container *ngIf="auth.currentUser; else loadingName">
            {{ (userDisplayName || 'Usuario').split(' ')[0] }}
          </ng-container>
          <ng-template #loadingName>...</ng-template>
        </h1>
        
        <p class="subtitle">
          <ion-icon name="bluetooth-outline"></ion-icon>
          {{ linkedDeviceId || 'Sincronizando...' }}
        </p>
      </div>

      <ion-button fill="clear" (click)="toggleLargeText({detail: {checked: !largeText}})">
        <ion-icon slot="icon-only" [name]="largeText ? 'text-outline' : 'text-outline'" style="color: white; opacity: 0.7;"></ion-icon>
      </ion-button>
    </div>
  </div>

  <div class="ion-padding-horizontal ion-margin-bottom">
    <button class="magic-button" (click)="activarEspejo()">
      <div class="icon-box">
        <ion-icon name="scan-outline"></ion-icon>
      </div>
      <div class="text-box">
        <h3>Usar Espejo Ahora</h3>
        <p>Sincronizar sesión</p>
      </div>
      <ion-icon name="chevron-forward-outline" class="arrow"></ion-icon>
    </button>
  </div>

  <div class="ion-padding-horizontal">
    <div class="glass-card status-card">
      <div class="card-header">
        <span class="card-title">Estado Actual</span>
        <span class="status-badge" [ngClass]="status" *ngIf="!loading">{{ statusText }}</span>
        <ion-skeleton-text animated style="width: 60px; height: 20px; border-radius: 10px;" *ngIf="loading"></ion-skeleton-text>
      </div>
      
      <p class="status-reason" *ngIf="!loading">{{ statusReason }}</p>
      <ion-skeleton-text animated style="width: 80%; height: 14px; margin-bottom: 20px;" *ngIf="loading"></ion-skeleton-text>

      <div *ngIf="loading" class="ion-padding-top">
        <div style="display: flex; gap: 10px;">
          <ion-skeleton-text animated style="height: 60px; width: 33%; border-radius: 12px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="height: 60px; width: 33%; border-radius: 12px;"></ion-skeleton-text>
          <ion-skeleton-text animated style="height: 60px; width: 33%; border-radius: 12px;"></ion-skeleton-text>
        </div>
      </div>

      <div class="stats-grid" *ngIf="!loading && reading">
        <div class="stat-item">
          <span class="label">HR</span>
          <span class="value">{{ reading.hr ?? '--' }}</span>
          <span class="unit">bpm</span>
        </div>
        <div class="stat-item">
          <span class="label">SpO₂</span>
          <span class="value">{{ reading.spo2 ?? '--' }}</span>
          <span class="unit">%</span>
        </div>
        <div class="stat-item">
          <span class="label">HRV</span>
          <span class="value">{{ reading.hrv ?? '--' }}</span>
          <span class="unit">ms</span>
        </div>
      </div>

      <div *ngIf="!loading && !reading" class="no-data">
        <p>No hay lecturas recientes para mostrar.</p>
      </div>
    </div>
  </div>

  <div class="ion-padding">
    <div class="glass-card chart-card">
      <div class="card-header">
        <span class="card-title">Tendencias</span>
        
        <div class="pill-selector">
          <span [class.active]="range === '30'" (click)="onRangeChange('30')">30</span>
          <span [class.active]="range === '100'" (click)="onRangeChange('100')">100</span>
          <span [class.active]="range === '24h'" (click)="onRangeChange('24h')">24h</span>
        </div>
      </div>

      <div class="chart-container">
        <ion-skeleton-text *ngIf="loadingCombined" animated style="height: 200px; width: 100%; opacity: 0.1; border-radius: 12px;"></ion-skeleton-text>
        
        <canvas *ngIf="!loadingCombined"
          baseChart
          [type]="'line'"
          [data]="combinedChartData"
          [plugins]="combinedPlugins"
          [options]="combinedOptions">
        </canvas>
      </div>
    </div>
  </div>

  <div class="ion-padding-horizontal ion-padding-bottom">
    <div class="actions-grid">
      <div class="glass-btn small" (click)="goAlerts()">
        <ion-icon name="notifications-outline" [color]="unreadAlerts > 0 ? 'warning' : 'medium'"></ion-icon>
        <span>{{ unreadAlerts }} Alertas</span>
      </div>

      <div class="glass-btn small" (click)="exportPDF()">
        <ion-icon name="document-text-outline"></ion-icon>
        <span>Reporte PDF</span>
      </div>
    </div>
  </div>

  <div style="height: 40px;"></div>

</ion-content>